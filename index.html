<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DebtFree Pro - Credit Card Debt Elimination</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DebtFree Pro">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .app-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .app-header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .app-header p {
            font-size: 1.2em;
            color: #666;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover {
            background: #f8f9fa;
        }

        .nav-tab.active:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        /* Setup Tab */
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .credit-card-form {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .credit-card-form:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-value.positive {
            color: #28a745;
        }

        .metric-value.negative {
            color: #dc3545;
        }

        .metric-label {
            color: #666;
            font-size: 1.1em;
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.8s ease;
            border-radius: 12px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Card List */
        .card-list {
            display: grid;
            gap: 20px;
        }

        .debt-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .debt-card.paid-off {
            background: #d4edda;
            border-color: #28a745;
        }

        .debt-card.focus {
            background: #fff3cd;
            border-color: #ffc107;
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }

        .debt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .debt-card-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .debt-card-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-focus {
            background: #fff3cd;
            color: #856404;
        }

        .status-minimum {
            background: #f8d7da;
            color: #721c24;
        }

        .debt-card-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .payment-instruction {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* Bonus List Styles */
        .bonus-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .bonus-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .bonus-content {
            flex: 1;
        }

        .bonus-title {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .bonus-details {
            color: #666;
            font-size: 0.9em;
        }

        .bonus-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #28a745;
            text-align: right;
            margin-right: 15px;
        }

        .bonus-actions {
            display: flex;
            gap: 10px;
        }

        .bonus-empty {
            text-align: center;
            color: #666;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #ddd;
        }
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .app-header h1 {
                font-size: 2em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                margin-bottom: 5px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .debt-card-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <h1>üí≥ DebtFree Pro</h1>
            <p>Your Personal Credit Card Debt Elimination Assistant</p>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
            <button class="nav-tab" data-tab="setup">‚öôÔ∏è Setup</button>
            <button class="nav-tab" data-tab="tracker">üìà Tracker</button>
            <button class="nav-tab" data-tab="plan">üìã Plan</button>
            <button class="nav-tab" data-tab="settings">üîß Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-value negative" id="totalDebt">$0</div>
                    <div class="metric-label">Total Debt</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="debtProgress" style="width: 0%"></div>
                            <div class="progress-text" id="progressText">0% Paid</div>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value positive" id="monthlyInterest">$0</div>
                    <div class="metric-label">Monthly Interest</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value positive" id="payoffMonths">0</div>
                    <div class="metric-label">Months to Freedom</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value positive" id="interestSavings">$0</div>
                    <div class="metric-label">Interest Savings</div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Current Focus</h2>
                <div id="currentFocus">
                    <p>Add your credit cards in the Setup tab to get started!</p>
                </div>
            </div>

            <div class="card">
                <h2>üìä Your Credit Cards</h2>
                <div class="card-list" id="dashboardCardList">
                    <!-- Cards will be populated here -->
                </div>
            </div>
        </div>

        <!-- Setup Tab -->
        <div class="tab-content" id="setup">
            <div class="card">
                <h2>üí≥ Add Your Credit Cards</h2>
                <div class="setup-grid">
                    <div class="credit-card-form">
                        <div class="form-group">
                            <label for="cardName">Card Name</label>
                            <input type="text" id="cardName" placeholder="e.g., Chase Sapphire Reserve">
                        </div>
                        <div class="form-group">
                            <label for="cardBalance">Current Balance</label>
                            <input type="number" id="cardBalance" placeholder="e.g., 4500.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="cardAPR">Interest Rate (APR %)</label>
                            <input type="number" id="cardAPR" placeholder="e.g., 24.99" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="cardMinPayment">Minimum Payment</label>
                            <input type="number" id="cardMinPayment" placeholder="e.g., 125.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="cardType">Card Type</label>
                            <select id="cardType">
                                <option value="personal">Personal</option>
                                <option value="business">Business</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="promoRate">Promotional 0% Rate?</label>
                            <select id="promoRate">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="form-group" id="promoEndGroup" style="display: none;">
                            <label for="promoEndDate">Promotional Rate End Date</label>
                            <input type="date" id="promoEndDate">
                        </div>
                        <button class="btn" onclick="addCreditCard(event)">‚ûï Add Card</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìã Your Cards</h2>
                <div id="setupCardList">
                    <!-- Added cards will appear here -->
                </div>
            </div>

            <div class="card">
                <h2>üí∞ Monthly Budget</h2>
                <div class="form-group">
                    <label for="monthlyIncome">Monthly Take-Home Income</label>
                    <input type="number" id="monthlyIncome" placeholder="e.g., 6500.00" step="0.01">
                </div>
                <div class="form-group">
                    <label for="fixedExpenses">Fixed Expenses (Rent, utilities, etc.)</label>
                    <input type="number" id="fixedExpenses" placeholder="e.g., 3750.00" step="0.01">
                </div>
                <div class="form-group">
                    <label for="variableExpenses">Variable Expenses (Food, entertainment, etc.)</label>
                    <input type="number" id="variableExpenses" placeholder="e.g., 1500.00" step="0.01">
                </div>
                <button class="btn" onclick="saveBudget(event)">üíæ Save Budget</button>
            </div>
        </div>

        <!-- Tracker Tab -->
        <div class="tab-content" id="tracker">
            <div class="card">
                <h2>üìà Monthly Progress Tracker</h2>
                <div class="form-group">
                    <label for="currentMonth">Select Current Month</label>
                    <select id="currentMonth">
                        <option value="1">Month 1 - Start</option>
                        <!-- Will be populated based on plan -->
                    </select>
                </div>
                <button class="btn" onclick="updateTracker()">üîÑ Update Progress</button>
            </div>

            <div class="card">
                <h2>üí≥ Update Card Balances</h2>
                <div id="trackerCardList">
                    <!-- Cards for balance updates will appear here -->
                </div>
            </div>

            <div class="card">
                <h2>üéØ This Month's Payment Plan</h2>
                <div id="monthlyPaymentPlan">
                    <!-- Monthly payment instructions will appear here -->
                </div>
            </div>
        </div>

        <!-- Plan Tab -->
        <div class="tab-content" id="plan">
            <div class="card">
                <h2>üóìÔ∏è Your Debt Elimination Timeline</h2>
                <div class="plan-timeline" id="planTimeline">
                    <!-- Timeline will be generated here -->
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="card">
                <div class="settings-section">
                    <h3>üéØ Debt Elimination Strategy</h3>
                    <div class="form-group">
                        <label for="strategy">Choose Your Strategy</label>
                        <select id="strategy">
                            <option value="avalanche">Debt Avalanche (Highest Interest First)</option>
                            <option value="snowball">Debt Snowball (Smallest Balance First)</option>
                            <option value="personal-first">Personal Cards First</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>üí∞ Bonus Payments</h3>
                    <div class="form-group">
                        <label for="bonusAmount">Expected Bonus Amount</label>
                        <input type="number" id="bonusAmount" placeholder="e.g., 5000.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="bonusMonth">Bonus Month</label>
                        <input type="month" id="bonusMonth">
                    </div>
                    <button class="btn" onclick="addBonus(event)">‚ûï Add Bonus</button>
                    
                    <div id="bonusList" style="margin-top: 20px;">
                        <!-- Bonus entries will appear here -->
                    </div>
                </div>

                <div class="settings-section">
                    <h3>üíæ Data Management</h3>
                    <button class="btn" onclick="exportData()">üì§ Export Data</button>
                    <button class="btn btn-secondary" onclick="importData()">üì• Import Data</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let appData = {
            cards: [],
            budget: {
                income: 0,
                fixedExpenses: 0,
                variableExpenses: 0
            },
            settings: {
                strategy: 'personal-first',
                currentMonth: 1,
                startDate: null
            },
            bonuses: []
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('debtFreeProData');
            if (saved) {
                appData = { ...appData, ...JSON.parse(saved) };
            }
            
            // Set start date if not set
            if (!appData.settings.startDate && appData.cards.length > 0) {
                appData.settings.startDate = new Date().toISOString().split('T')[0];
                saveData();
            }
            
            updateAllDisplays();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('debtFreeProData', JSON.stringify(appData));
        }

        // Tab functionality
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and content
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        // Promotional rate toggle
        document.getElementById('promoRate').addEventListener('change', function() {
            const promoEndGroup = document.getElementById('promoEndGroup');
            if (this.value === 'yes') {
                promoEndGroup.style.display = 'block';
            } else {
                promoEndGroup.style.display = 'none';
            }
        });

        // Add credit card
        function addCreditCard() {
            const name = document.getElementById('cardName').value;
            const balance = parseFloat(document.getElementById('cardBalance').value);
            const apr = parseFloat(document.getElementById('cardAPR').value);
            const minPayment = parseFloat(document.getElementById('cardMinPayment').value);
            const type = document.getElementById('cardType').value;
            const promoRate = document.getElementById('promoRate').value === 'yes';
            const promoEndDate = document.getElementById('promoEndDate').value;

            if (!name || isNaN(balance) || isNaN(minPayment)) {
                alert('Please fill in all required fields');
                return;
            }

            const card = {
                id: Date.now(),
                name: name,
                balance: balance,
                initialBalance: balance,
                apr: promoRate ? 0 : apr,
                minPayment: minPayment,
                type: type,
                promoRate: promoRate,
                promoEndDate: promoEndDate || null,
                actualAPR: apr
            };

            appData.cards.push(card);
            saveData();
            updateAllDisplays();
            clearForm();
        }

        // Clear form
        function clearForm() {
            document.getElementById('cardName').value = '';
            document.getElementById('cardBalance').value = '';
            document.getElementById('cardAPR').value = '';
            document.getElementById('cardMinPayment').value = '';
            document.getElementById('cardType').value = 'personal';
            document.getElementById('promoRate').value = 'no';
            document.getElementById('promoEndDate').value = '';
            document.getElementById('promoEndGroup').style.display = 'none';
        }

        // Save budget
        function saveBudget() {
            appData.budget = {
                income: parseFloat(document.getElementById('monthlyIncome').value) || 0,
                fixedExpenses: parseFloat(document.getElementById('fixedExpenses').value) || 0,
                variableExpenses: parseFloat(document.getElementById('variableExpenses').value) || 0
            };
            saveData();
            updateAllDisplays();
            alert('Budget saved successfully!');
        }

        // Calculate available for debt payments
        function calculateAvailableForDebt() {
            const totalMinPayments = appData.cards.reduce((sum, card) => sum + card.minPayment, 0);
            return appData.budget.income - appData.budget.fixedExpenses - appData.budget.variableExpenses - totalMinPayments;
        }

        // Calculate monthly interest
        function calculateMonthlyInterest() {
            return appData.cards.reduce((sum, card) => {
                if (card.balance > 0) {
                    return sum + (card.balance * (card.apr / 100) / 12);
                }
                return sum;
            }, 0);
        }

        // Update all displays
        function updateAllDisplays() {
            updateDashboard();
            updateSetupCardList();
            updateTrackerCardList();
            updateMonthOptions();
            generatePlan();
            updateBonusList(); // Add bonus list update
            
            // Update budget fields
            document.getElementById('monthlyIncome').value = appData.budget.income;
            document.getElementById('fixedExpenses').value = appData.budget.fixedExpenses;
            document.getElementById('variableExpenses').value = appData.budget.variableExpenses;
        }

        // Update dashboard
        function updateDashboard() {
            const totalDebt = appData.cards.reduce((sum, card) => sum + card.balance, 0);
            const initialDebt = appData.cards.reduce((sum, card) => sum + card.initialBalance, 0);
            const monthlyInterest = calculateMonthlyInterest();
            
            document.getElementById('totalDebt').textContent = `$${totalDebt.toLocaleString()}`;
            document.getElementById('monthlyInterest').textContent = `$${monthlyInterest.toFixed(2)}`;
            
            // Progress bar
            const progress = initialDebt > 0 ? ((initialDebt - totalDebt) / initialDebt) * 100 : 0;
            document.getElementById('debtProgress').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${progress.toFixed(1)}% Paid`;
            
            // Current focus
            updateCurrentFocus();
            
            // Dashboard card list
            updateDashboardCardList();
        }

        // Update current focus
        function updateCurrentFocus() {
            const focusElement = document.getElementById('currentFocus');
            
            if (appData.cards.length === 0) {
                focusElement.innerHTML = '<p>Add your credit cards in the Setup tab to get started!</p>';
                return;
            }

            const strategy = appData.settings.strategy;
            let focusCard = null;

            if (strategy === 'avalanche') {
                focusCard = appData.cards
                    .filter(card => card.balance > 0)
                    .sort((a, b) => b.apr - a.apr)[0];
            } else if (strategy === 'snowball') {
                focusCard = appData.cards
                    .filter(card => card.balance > 0)
                    .sort((a, b) => a.balance - b.balance)[0];
            } else if (strategy === 'personal-first') {
                const personalCards = appData.cards.filter(card => card.type === 'personal' && card.balance > 0);
                if (personalCards.length > 0) {
                    focusCard = personalCards.sort((a, b) => b.apr - a.apr)[0];
                } else {
                    focusCard = appData.cards
                        .filter(card => card.balance > 0)
                        .sort((a, b) => b.apr - a.apr)[0];
                }
            }

            if (focusCard) {
                const availableExtra = calculateAvailableForDebt();
                const recommendedPayment = focusCard.minPayment + Math.max(0, availableExtra);
                
                focusElement.innerHTML = `
                    <div class="debt-card focus">
                        <div class="debt-card-header">
                            <div class="debt-card-name">üéØ ${focusCard.name}</div>
                            <div class="debt-card-status status-focus">FOCUS CARD</div>
                        </div>
                        <div class="debt-card-details">
                            <div class="detail-item">
                                <div class="detail-label">Balance</div>
                                <div class="detail-value">$${focusCard.balance.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Interest Rate</div>
                                <div class="detail-value">${focusCard.apr}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Min Payment</div>
                                <div class="detail-value">$${focusCard.minPayment}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Available Extra</div>
                                <div class="detail-value">$${Math.max(0, availableExtra).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="payment-instruction">
                            üí∞ Recommended Payment: $${recommendedPayment.toFixed(2)}
                        </div>
                    </div>
                `;
            } else {
                focusElement.innerHTML = '<p class="metric-value positive">üéâ Congratulations! All debt eliminated!</p>';
            }
        }

        // Update dashboard card list
        function updateDashboardCardList() {
            const container = document.getElementById('dashboardCardList');
            
            if (appData.cards.length === 0) {
                container.innerHTML = '<p>No credit cards added yet. Go to Setup to add your cards.</p>';
                return;
            }

            container.innerHTML = appData.cards.map(card => {
                const isPaidOff = card.balance <= 0;
                const monthlyInterest = card.balance > 0 ? (card.balance * (card.apr / 100) / 12) : 0;
                
                return `
                    <div class="debt-card ${isPaidOff ? 'paid-off' : ''}">
                        <div class="debt-card-header">
                            <div class="debt-card-name">${card.name}</div>
                            <div class="debt-card-status ${isPaidOff ? 'status-paid' : 'status-minimum'}">
                                ${isPaidOff ? '‚úÖ PAID OFF' : 'üìù ACTIVE'}
                            </div>
                        </div>
                        <div class="debt-card-details">
                            <div class="detail-item">
                                <div class="detail-label">Balance</div>
                                <div class="detail-value">${card.balance.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Interest Rate</div>
                                <div class="detail-value">${card.apr}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Min Payment</div>
                                <div class="detail-value">${card.minPayment}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Monthly Interest</div>
                                <div class="detail-value">${monthlyInterest.toFixed(2)}</div>
                            </div>
                        </div>
                        ${card.promoRate && card.promoEndDate ? 
                            `<div style="background: #fff3cd; padding: 10px; margin-top: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                                ‚ö†Ô∏è Promotional 0% rate expires: ${new Date(card.promoEndDate).toLocaleDateString()}
                            </div>` : ''
                        }
                    </div>
                `;
            }).join('');
        }

        // Update setup card list
        function updateSetupCardList() {
            const container = document.getElementById('setupCardList');
            
            if (appData.cards.length === 0) {
                container.innerHTML = '<p>No credit cards added yet.</p>';
                return;
            }

            container.innerHTML = appData.cards.map(card => `
                <div class="debt-card">
                    <div class="debt-card-header">
                        <div class="debt-card-name">${card.name}</div>
                        <div>
                            <button class="btn btn-secondary" onclick="editCard(${card.id})" style="margin-right: 10px;">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" onclick="deleteCard(${card.id})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                    <div class="debt-card-details">
                        <div class="detail-item">
                            <div class="detail-label">Balance</div>
                            <div class="detail-value">${card.balance.toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Interest Rate</div>
                            <div class="detail-value">${card.apr}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Min Payment</div>
                            <div class="detail-value">${card.minPayment}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Type</div>
                            <div class="detail-value">${card.type}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update tracker card list
        function updateTrackerCardList() {
            const container = document.getElementById('trackerCardList');
            
            if (appData.cards.length === 0) {
                container.innerHTML = '<p>No credit cards to track. Add cards in the Setup tab.</p>';
                return;
            }

            container.innerHTML = appData.cards.map(card => `
                <div class="debt-card">
                    <div class="debt-card-header">
                        <div class="debt-card-name">${card.name}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Current Balance</label>
                            <input type="number" value="${card.balance}" step="0.01" 
                                   onchange="updateCardBalance(${card.id}, this.value, event)">
                        </div>
                        <div class="form-group">
                            <label>Last Payment Made</label>
                            <input type="number" placeholder="Enter payment amount" step="0.01" 
                                   onchange="recordPayment(${card.id}, this.value, event)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update card balance
        function updateCardBalance(cardId, newBalance) {
            const card = appData.cards.find(c => c.id === cardId);
            if (card) {
                card.balance = parseFloat(newBalance) || 0;
                saveData();
                updateAllDisplays();
            }
        }

        // Record payment
        function recordPayment(cardId, paymentAmount) {
            const card = appData.cards.find(c => c.id === cardId);
            const payment = parseFloat(paymentAmount) || 0;
            
            if (card && payment > 0) {
                card.balance = Math.max(0, card.balance - payment);
                saveData();
                updateAllDisplays();
                
                // Clear the payment input
                event.target.value = '';
                
                // Show success message
                alert(`Payment of ${payment.toFixed(2)} recorded for ${card.name}!`);
            }
        }

        // Generate payment plan
        function generatePlan() {
            const container = document.getElementById('planTimeline');
            
            if (appData.cards.length === 0) {
                container.innerHTML = '<p>Add your credit cards to generate a payment plan.</p>';
                return;
            }

            const availableExtra = calculateAvailableForDebt();
            const totalMinPayments = appData.cards.reduce((sum, card) => sum + card.minPayment, 0);
            
            let plan = [];
            let cards = [...appData.cards].filter(card => card.balance > 0);
            let month = 1;
            
            while (cards.length > 0 && month <= 60) {
                const strategy = appData.settings.strategy;
                let focusCard;
                
                if (strategy === 'avalanche') {
                    focusCard = cards.sort((a, b) => b.apr - a.apr)[0];
                } else if (strategy === 'snowball') {
                    focusCard = cards.sort((a, b) => a.balance - b.balance)[0];
                } else {
                    const personalCards = cards.filter(card => card.type === 'personal');
                    if (personalCards.length > 0) {
                        focusCard = personalCards.sort((a, b) => b.apr - a.apr)[0];
                    } else {
                        focusCard = cards.sort((a, b) => b.apr - a.apr)[0];
                    }
                }
                
                const extraPayment = availableExtra > 0 ? availableExtra : 0;
                const totalPayment = focusCard.minPayment + extraPayment;
                const interestCharge = focusCard.balance * (focusCard.apr / 100) / 12;
                const principalPayment = totalPayment - interestCharge;
                
                plan.push({
                    month: month,
                    focusCard: focusCard.name,
                    payment: totalPayment,
                    balanceAfter: Math.max(0, focusCard.balance - principalPayment)
                });
                
                focusCard.balance = Math.max(0, focusCard.balance - principalPayment);
                cards = cards.filter(card => card.balance > 0);
                month++;
            }
            
            container.innerHTML = plan.map((monthPlan, index) => `
                <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #e9ecef;">
                    <div style="width: 60px; height: 60px; background: ${index === 0 ? '#ffc107' : '#6c757d'}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 20px;">
                        ${monthPlan.month}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; margin-bottom: 5px;">Month ${monthPlan.month}</div>
                        <div style="color: #666; font-size: 0.9em;">Focus: ${monthPlan.focusCard}</div>
                        <div style="color: #666; font-size: 0.9em;">Balance after payment: ${monthPlan.balanceAfter.toLocaleString()}</div>
                    </div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">${monthPlan.payment.toFixed(2)}</div>
                </div>
            `).join('');
            
            // Restore original balances
            loadData();
        }

        // Update month options
        function updateMonthOptions() {
            const select = document.getElementById('currentMonth');
            const options = [];
            
            for (let i = 1; i <= 36; i++) {
                const date = new Date();
                date.setMonth(date.getMonth() + i - 1);
                options.push(`<option value="${i}">Month ${i} - ${date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</option>`);
            }
            
            select.innerHTML = options.join('');
            select.value = appData.settings.currentMonth;
        }

        // Update tracker
        function updateTracker() {
            const month = parseInt(document.getElementById('currentMonth').value);
            appData.settings.currentMonth = month;
            saveData();
            updateMonthlyPaymentPlan();
        }

        // Update monthly payment plan
        function updateMonthlyPaymentPlan() {
            const container = document.getElementById('monthlyPaymentPlan');
            const availableExtra = calculateAvailableForDebt();
            
            if (appData.cards.length === 0) {
                container.innerHTML = '<p>No payment plan available. Add cards first.</p>';
                return;
            }

            const totalMinPayments = appData.cards.reduce((sum, card) => sum + card.minPayment, 0);
            
            container.innerHTML = `
                <div class="card">
                    <h3>üí∞ Budget Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="detail-item">
                            <div class="detail-label">Monthly Income</div>
                            <div class="detail-value">${appData.budget.income.toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Expenses</div>
                            <div class="detail-value">${(appData.budget.fixedExpenses + appData.budget.variableExpenses).toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Min Payments</div>
                            <div class="detail-value">${totalMinPayments.toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Available Extra</div>
                            <div class="detail-value" style="color: ${availableExtra >= 0 ? '#28a745' : '#dc3545'};">${availableExtra.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìã Payment Instructions</h3>
                    ${appData.cards.filter(card => card.balance > 0).map((card, index) => {
                        const isFocus = index === 0;
                        const payment = isFocus ? card.minPayment + Math.max(0, availableExtra) : card.minPayment;
                        
                        return `
                            <div class="debt-card ${isFocus ? 'focus' : ''}">
                                <div class="debt-card-header">
                                    <div class="debt-card-name">${card.name}</div>
                                    <div class="debt-card-status ${isFocus ? 'status-focus' : 'status-minimum'}">
                                        ${isFocus ? 'üéØ FOCUS' : 'üìù MINIMUM'}
                                    </div>
                                </div>
                                <div class="payment-instruction">
                                    Pay: ${payment.toFixed(2)}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Delete card
        function deleteCard(cardId) {
            if (confirm('Are you sure you want to delete this card?')) {
                appData.cards = appData.cards.filter(card => card.id !== cardId);
                saveData();
                updateAllDisplays();
            }
        }

        // Edit card (simplified)
        function editCard(cardId) {
            const card = appData.cards.find(c => c.id === cardId);
            if (card) {
                const newBalance = prompt('Enter new balance:', card.balance);
                if (newBalance !== null) {
                    card.balance = parseFloat(newBalance) || 0;
                    saveData();
                    updateAllDisplays();
                }
            }
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], {type:'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'debtfree-pro-data.json';
            link.click();
        }

        // Import data
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const imported = JSON.parse(e.target.result);
                            appData = imported;
                            saveData();
                            updateAllDisplays();
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                localStorage.removeItem('debtFreeProData');
                appData = {
                    cards: [],
                    budget: { income: 0, fixedExpenses: 0, variableExpenses: 0 },
                    settings: { strategy: 'personal-first', currentMonth: 1 },
                    bonuses: []
                };
                updateAllDisplays();
                alert('All data cleared successfully!');
            }
        }

        // Enhanced add bonus with better UX
        function addBonus() {
            const amountInput = document.getElementById('bonusAmount');
            const monthInput = document.getElementById('bonusMonth');
            const amount = parseFloat(amountInput.value);
            const month = monthInput.value;

            // Show loading state
            const addButton = event.target;
            const originalText = addButton.textContent;
            addButton.textContent = '‚è≥ Adding Bonus...';
            addButton.disabled = true;

            // Validation
            if (!amount || amount <= 0) {
                showToast('Please enter a valid bonus amount', 'error');
                resetButton(addButton, originalText);
                return;
            }

            if (!month) {
                showToast('Please select a bonus month', 'error');
                resetButton(addButton, originalText);
                return;
            }

            // Check if bonus already exists for this month
            const existingBonus = appData.bonuses.find(bonus => bonus.month === month);
            if (existingBonus) {
                showToast('A bonus already exists for this month. Delete it first to add a new one.', 'warning');
                resetButton(addButton, originalText);
                return;
            }

            // Create bonus object
            const bonus = {
                id: Date.now(),
                amount: amount,
                month: month,
                createdDate: new Date().toISOString().split('T')[0]
            };

            // Add bonus
            appData.bonuses.push(bonus);
            saveData();

            // Clear form
            amountInput.value = '';
            monthInput.value = '';

            // Update display
            updateBonusList();

            // Show success message
            const monthName = new Date(month + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            showToast(`‚úÖ Bonus of ${amount.toLocaleString()} added for ${monthName}!`, 'success');

        // Reset button helper
        function resetButton(button, originalText) {
            button.textContent = originalText;
            button.disabled = false;
        }

        // Enhanced clear form
        function clearForm() {
            document.getElementById('cardName').value = '';
            document.getElementById('cardBalance').value = '';
            document.getElementById('cardAPR').value = '';
            document.getElementById('cardMinPayment').value = '';
            document.getElementById('cardType').value = 'personal';
            document.getElementById('promoRate').value = 'no';
            document.getElementById('promoEndDate').value = '';
            document.getElementById('promoEndGroup').style.display = 'none';
        }

        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());

            // Create toast
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = message;
            
            // Style the toast
            Object.assign(toast.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '15px 20px',
                borderRadius: '8px',
                color: 'white',
                fontWeight: '600',
                zIndex: '10000',
                maxWidth: '400px',
                wordWrap: 'break-word',
                boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                transform: 'translateX(100%)',
                transition: 'transform 0.3s ease'
            });

            // Set background color based on type
            switch(type) {
                case 'success':
                    toast.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                    break;
                case 'error':
                    toast.style.background = 'linear-gradient(135deg, #dc3545, #e74c3c)';
                    break;
                case 'warning':
                    toast.style.background = 'linear-gradient(135deg, #ffc107, #fd7e14)';
                    break;
                default:
                    toast.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            }

            // Add to page
            document.body.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);

            // Auto remove
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, duration);

            // Click to dismiss
            toast.addEventListener('click', () => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            });
        }

        // Show card payoff celebration
        function showCardPayoffCelebration(card) {
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: white;
                    padding: 40px;
                    border-radius: 20px;
                    text-align: center;
                    max-width: 500px;
                    margin: 20px;
                    transform: scale(0.8);
                    transition: transform 0.3s ease;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #28a745; margin-bottom: 15px;">CARD PAID OFF!</h2>
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">${card.name}</h3>
                    <p style="color: #666; margin-bottom: 20px;">Congratulations! You've completely eliminated this debt!</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left;">
                        <strong>Original Balance:</strong> ${card.initialBalance.toLocaleString()}<br>
                        <strong>Interest Rate:</strong> ${card.actualAPR}%<br>
                        <strong>Monthly Interest Saved:</strong> ${((card.initialBalance * card.actualAPR / 100) / 12).toFixed(2)}
                    </div>
                    <button onclick="closeCelebration(this)" style="
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        padding: 12px 25px;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1em;
                        font-weight: 600;
                    ">On to the Next One! üöÄ</button>
                </div>
            `;

            document.body.appendChild(overlay);
            
            // Animate in
            setTimeout(() => {
                overlay.style.opacity = '1';
                overlay.querySelector('div > div').style.transform = 'scale(1)';
            }, 100);

            // Auto-close after 5 seconds
            setTimeout(() => {
                if (overlay.parentNode) {
                    closeCelebration(overlay.querySelector('button'));
                }
            }, 5000);
        }

        // Close celebration overlay
        function closeCelebration(button) {
            const overlay = button.closest('.celebration-overlay') || button.parentElement.parentElement;
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.parentNode.removeChild(overlay);
                    }
                }, 300);
            }
        }

        // Update bonus list display
        function updateBonusList() {
            const container = document.getElementById('bonusList');
            
            if (!container) return;

            if (!appData.bonuses || appData.bonuses.length === 0) {
                container.innerHTML = `
                    <div class="bonus-empty">
                        <div style="font-size: 2em; margin-bottom: 10px;">üí∞</div>
                        <p>No bonus payments scheduled yet.</p>
                        <p style="font-size: 0.9em; margin-top: 5px;">Add expected bonuses above to include them in your debt elimination plan.</p>
                    </div>
                `;
                return;
            }

            // Sort bonuses by month
            const sortedBonuses = [...appData.bonuses].sort((a, b) => new Date(a.month) - new Date(b.month));

            container.innerHTML = sortedBonuses.map(bonus => {
                const bonusDate = new Date(bonus.month + '-01');
                const monthName = bonusDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                const isUpcoming = bonusDate >= new Date();
                const daysSinceCreated = Math.floor((new Date() - new Date(bonus.createdDate)) / (1000 * 60 * 60 * 24));

                return `
                    <div class="bonus-item">
                        <div class="bonus-content">
                            <div class="bonus-title">üí∞ ${monthName} Bonus</div>
                            <div class="bonus-details">
                                ${isUpcoming ? `Scheduled for ${monthName}` : `Was scheduled for ${monthName}`} ‚Ä¢ 
                                Added ${daysSinceCreated === 0 ? 'today' : `${daysSinceCreated} days ago`}
                            </div>
                        </div>
                        <div class="bonus-amount">${bonus.amount.toLocaleString()}</div>
                        <div class="bonus-actions">
                            <button class="btn btn-secondary" onclick="editBonus(${bonus.id})" style="padding: 8px 15px; font-size: 0.9em;">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" onclick="deleteBonus(${bonus.id})" style="padding: 8px 15px; font-size: 0.9em;">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Edit bonus
        function editBonus(bonusId) {
            const bonus = appData.bonuses.find(b => b.id === bonusId);
            if (!bonus) return;

            const newAmount = prompt('Enter new bonus amount:', bonus.amount);
            if (newAmount === null) return; // User cancelled

            const amount = parseFloat(newAmount);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid bonus amount', 'error');
                return;
            }

            // Update bonus
            bonus.amount = amount;
            saveData();
            updateBonusList();

            const monthName = new Date(bonus.month + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            showToast(`‚úÖ ${monthName} bonus updated to ${amount.toLocaleString()}`, 'success');
        }

        // Delete bonus
        function deleteBonus(bonusId) {
            const bonus = appData.bonuses.find(b => b.id === bonusId);
            if (!bonus) return;

            const monthName = new Date(bonus.month + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            if (confirm(`Are you sure you want to delete the ${monthName} bonus of ${bonus.amount.toLocaleString()}?`)) {
                appData.bonuses = appData.bonuses.filter(b => b.id !== bonusId);
                saveData();
                updateBonusList();
                showToast(`‚úÖ ${monthName} bonus deleted successfully`, 'success');
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // Set default strategy
            document.getElementById('strategy').value = appData.settings.strategy;
            document.getElementById('strategy').addEventListener('change', function() {
                appData.settings.strategy = this.value;
                saveData();
                updateAllDisplays();
            });
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    }, function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
